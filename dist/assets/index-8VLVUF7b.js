(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();var f;(e=>{e.Option=(()=>{const r=Symbol("Option::Some"),a=Symbol("Option::None"),t=function(s){return{tag:r,i:1,value:s,unwrap:()=>s}},o=function(){return{tag:a,i:0,unwrap(){throw new Error("Attempting to unwrap Option.None")}}};function i(s){return E(s)?"tag"in s&&s.tag==r:!1}return Object.freeze({Some:t,get None(){return o()},is_some:i})})(),e.Result=(()=>{const r=Symbol("Result::Error"),a=Symbol("Result::Ok");function t(l){const c=Object.create(null);return Object.defineProperties(c,{tag:{configurable:!1,enumerable:!1,writable:!1,value:r},i:{configurable:!1,enumerable:!0,writable:!1,value:0},error:{configurable:!1,enumerable:!0,writable:!1,value:l},toString:{configurable:!1,enumerable:!1,writable:!1,value:()=>`Result::Error(${l})`},unwrap:{configurable:!1,enumerable:!1,writable:!1,value:()=>{throw new Error("Attempting to unwrap Result.Error")}}}),c}function o(l){const c=Object.create(null);return Object.defineProperties(c,{tag:{configurable:!1,enumerable:!1,writable:!1,value:a},i:{configurable:!1,enumerable:!0,writable:!1,value:1},value:{configurable:!1,enumerable:!0,writable:!1,value:l},toString:{configurable:!1,enumerable:!1,writable:!1,value:()=>`Result::Ok(${l})`},unwrap:{configurable:!1,enumerable:!1,writable:!1,value:()=>l}}),c}function i(l){return E(l)?"tag"in l&&l.tag==r:!1}function s(l){return E(l)?"tag"in l&&l.tag==a:!1}function d(l){if(i(l))throw new Error("Attempting to unwrap Enum.Result.Error");return l.value}return Object.freeze({Err:t,Ok:o,is_err:i,is_ok:s,unwrap:d})})();function n(r,...a){const t={};Object.defineProperties(t,{toString:{enumerable:!1,configurable:!1,writable:!1,value:()=>`Enum(${r})`},count:{enumerable:!1,configurable:!1,writable:!1,value:()=>a.length},keys:{enumerable:!1,configurable:!1,writable:!1,value:()=>[...a]},values:{enumerable:!1,configurable:!1,writable:!1,value:()=>Array.from({length:a.length}).map((o,i)=>i)},entries:{enumerable:!1,configurable:!1,writable:!1,value:()=>a.map((o,i)=>[o,i])},nameOf:{enumerable:!1,configurable:!1,writable:!1,value:o=>o in a?e.Option.Some(a[o]):e.Option.None}});for(let o=0;o<a.length;++o)t[a[o]]={[Symbol.toPrimitive](i){return i=="string"?a[o]:o},value:o,name:a[o]};return t}e.create=n})(f||(f={}));var q;(e=>{function n(o){return i=>i.map(o)}e.map=n;function r(o){return i=>i.filter(o)}e.filter=r;function a(o){return i=>{let s=[];for(let d=0;d<i.length;++d){const l=i[d],c=o(l,d);f.Option.is_some(c)&&s.push(c.unwrap())}return s}}e.filter_map=a;function t(o){return o?o.reduce((i,s)=>i+s,0):i=>i.reduce((s,d)=>s+d,0)}e.sum=t})(q||(q={}));function K(e){return typeof e=="function"}function E(e){return typeof e=="object"&&e!=null}function A(e){return!E(e)||!("next"in e)?!1:K(e.next)}function P(e,n){let r=typeof n<"u"?e.next(n):e.next(),a=r.value;return a instanceof Promise?a.then(t=>({done:r.done,value:t})):r}async function O(e){let n=typeof e=="function"?e():e;if(!A(n)){console.error("Expected Generator or a function that returns a Generator");return}let r=P(n);for(;;){if(r instanceof Promise){r=await r;continue}if(A(r.value)){r.value=await O(r.value);continue}if(r.done)break;r=P(n,r.value)}return r.value}function*T(e,...n){let r=yield typeof e=="function"?e():e;n.reverse();let a=n.pop();for(;a!=null;)r=a(r),A(r)?r=yield*r:r=yield r,a=n.pop();return r}const b=f.Result,m=f.Option,u=f.create("NodeKind","X","Y","T","Random","Rule","Number","Bool","Sqrt","Add","Mult","Mod","GT","Triple","If");console.log(`NK Count is ${u.count()}`);console.assert(u.count()==14,"Exhaustive check of NodeKind");class H extends Error{constructor(){super("No Canvas element was found")}}class z extends Error{constructor(){super("Context 2D is unsupported in the user's browser")}}class U extends Error{constructor(n){super(`No element matchin selector "${n}" was found`)}}const w=500,g=w;let S=!1;function I(e,n){return Math.random()*(n-e)+e}function k(e){const n=document.querySelector(e);return n?b.Ok(n):b.Err(new U(e))}function Q(){const e=k("#canvas");if(b.is_err(e))return b.Err(new H);const n=e.unwrap();n.width=w,n.height=g;const r=n.getContext("2d");return r?b.Ok({cnv:n,ctx:r}):b.Err(new z)}function j(){return new Uint8ClampedArray(Array.from({length:w*g*4}).map(()=>255))}function*W(e,n){try{const r=yield*T(()=>j(),a=>T(ee(),([t,o])=>C(o,t),t=>t.unwrap(),t=>{if(t.kind!=u.Triple)throw new Error("Entry rule result must be a triple");return t},t=>h([],t,20),t=>t.unwrap(),t=>_(t),t=>(n.innerText=v(t),T(()=>D(t,a),o=>[o,t]))),([a,t])=>[new ImageData(a,w,g),t],([a,t])=>(e.clearRect(0,0,w,g),e.putImageData(a,0,0),t));return b.Ok(r)}catch(r){return console.error("RandomArt Failed:",r),b.Err(r)}}O(function*(){const n=k("#ctxP").unwrap(),r=k("#genBtn").unwrap(),a=k("#animBtn").unwrap(),t=k("#formula").unwrap(),o=Q();if(b.is_err(o)){console.error(o.error);return}const{ctx:i}=o.value;let s;function*d(){n.innerText="Generating...",r.disabled=!0,a.disabled=!0;let c=yield*W(i,t);b.is_err(c)&&(n.innerText=`Generation Failed: ${c.error}`),b.is_err(c)||(n.innerText="Function used:",s=c.value),r.disabled=!1,a.disabled=!1}r.addEventListener("click",()=>{O(d())}),a.addEventListener("click",()=>{S=!S,S?a.innerText="Stop Animating":a.innerText="Start Animating"}),O(()=>d());const l=()=>{requestAnimationFrame(l),!(!S||!s)&&O(T(()=>j(),c=>D(s,c),c=>new ImageData(c,w,g),c=>{i.clearRect(0,0,w,g),i.putImageData(c,0,0)}))};requestAnimationFrame(l)}).catch(console.error);function G(e){return{kind:u.Rule,rule:e}}function J(e,n,r){return{kind:u.Triple,a:e,b:n,c:r}}function y(e){return{kind:u.Number,value:e}}function V(){return{kind:u.Random}}function R(){return{kind:u.X}}function M(){return{kind:u.Y}}function x(){return{kind:u.T}}function $(e,n){return{kind:u.Add,lhs:e,rhs:n}}function N(e,n){return{kind:u.Mult,lhs:e,rhs:n}}function B(e){return{kind:u.Sqrt,value:e}}function Z(e){return{kind:u.Bool,value:e}}function ee(){const a=()=>G(1),t=()=>G(2),o=[];return o.push([J(t(),t(),t())]),o.push([V(),R(),M(),x(),B($($(N(R(),R()),N(M(),M())),N(x(),x())))]),o.push([a(),t(),$(t(),t()),N(t(),t()),B(t())]),[0,o]}function v(e){switch(e.kind){case u.X:case u.Y:case u.T:return`${e.kind}`;case u.Number:return`${e.value}`;case u.Bool:return e.value?"true":"false";case u.Random:return"(random)";case u.Sqrt:return`${e.kind}(${v(e.value)})`;case u.Mult:case u.Mod:case u.Add:case u.GT:const n=v(e.lhs),r=v(e.rhs);return`${e.kind}(${n}, ${r})`;case u.Triple:const a=v(e.a),t=v(e.b),o=v(e.c);return`(${a}, ${t}, ${o})`;case u.Rule:return`rule(${e.rule})`;default:throw new Error(`Node(${e.kind}) not added to generation yet`)}}function*h(e,n,r){switch(n.kind){case u.X:case u.Y:case u.T:case u.Number:case u.Bool:return f.Option.Some(n);case u.Random:return f.Option.Some({kind:u.Number,value:I(-1,1)});case u.Sqrt:const a=yield*h(e,n.value,r);return f.Option.is_some(a)?f.Option.Some({kind:n.kind,value:a.unwrap()}):a;case u.Mult:case u.Mod:case u.Add:case u.GT:const t=yield*h(e,n.lhs,r);if(!f.Option.is_some(t))return t;const o=yield*h(e,n.rhs,r);return f.Option.is_some(o)?f.Option.Some({kind:n.kind,lhs:t.unwrap(),rhs:o.unwrap()}):o;case u.Triple:const i=yield*h(e,n.a,r);if(!f.Option.is_some(i))return i;const s=yield*h(e,n.b,r);if(!f.Option.is_some(s))return s;const d=yield*h(e,n.c,r);return f.Option.is_some(d)?f.Option.Some({kind:n.kind,a:i.unwrap(),b:s.unwrap(),c:d.unwrap()}):d;case u.Rule:return yield*C(e,n.rule,r-1);default:throw new Error(`Node(${n.kind}) not added to generation yet`)}}function p(e,n,r,a){switch(e.kind){case u.X:return m.Some(n);case u.Y:return m.Some(r);case u.T:return m.Some(a);case u.Number:return m.Some(e.value);case u.Bool:return m.Some(e.value?1:0);case u.Mult:{const t=p(e.lhs,n,r,a).unwrap(),o=p(e.rhs,n,r,a).unwrap();return m.Some(t*o)}case u.Mod:{const t=p(e.lhs,n,r,a).unwrap(),o=p(e.rhs,n,r,a).unwrap();return m.Some(t%o)}case u.Add:{const t=p(e.lhs,n,r,a).unwrap(),o=p(e.rhs,n,r,a).unwrap();return m.Some(t+o)}case u.GT:{const t=p(e.lhs,n,r,a).unwrap(),o=p(e.rhs,n,r,a).unwrap();return m.Some(t>o?1:0)}case u.Sqrt:{const t=p(e.value,n,r,a).unwrap();return m.Some(Math.sqrt(t))}case u.Triple:{const t=p(e.a,n,r,a).unwrap(),o=p(e.b,n,r,a).unwrap(),i=p(e.c,n,r,a).unwrap();return m.Some([t,o,i])}case u.Rule:case u.Random:return console.error(`Cannot evaluate node kind ${e.kind} as it's a grammar only node`),m.None;default:throw new Error(`Node(${e.kind}) not added to generation yet`)}}function*_(e){switch(e.kind){case u.Sqrt:const n=yield*_(e.value);return n.kind!=u.Number?e:y(Math.sqrt(n.value));case u.Mult:case u.Mod:case u.Add:case u.GT:const r=yield*_(e.lhs);if(r.kind!=u.Number)return e;const a=yield*_(e.rhs);return a.kind!=u.Number?e:e.kind==u.Mult?y(r.value*a.value):e.kind==u.Mod?y(r.value%a.value):e.kind==u.Add?y(r.value+a.value):e.kind==u.GT?Z(r.value>a.value):e;case u.Triple:const t=yield*_(e.a),o=yield*_(e.b),i=yield*_(e.c);return{kind:e.kind,a:t,b:o,c:i};case u.X:case u.Y:case u.T:case u.Number:case u.Bool:case u.Random:default:return e}}function*C(e,n,r=25){const a=e[n];if(!a||a.length<=0)return console.log("Invalid rule provided"),m.None;const t=r<=0?a[0]:a[Math.floor(I(0,a.length))],o=yield*h(e,t,r);if(!f.Option.is_some(o))return o;const i=o.unwrap();return m.Some(i)}function*D(e,n){const r=Math.sin(Date.now());for(let a=0;a<g;++a){const t=a/g*2-1;for(let o=0;o<w;++o){const i=o/w*2-1,s=(a*w+o)*4,d=yield p(e,i,t,r),[l,c,F]=d.unwrap(),L=Math.round((l+1)/2*255),X=Math.round((c+1)/2*255),Y=Math.round((F+1)/2*255);n[s+0]=L,n[s+1]=X,n[s+2]=Y,n[s+3]=255}yield new Promise(o=>setTimeout(o,1))}return n}
